# Start with a base image containing Tomcat server running with JRE8
FROM maven:3.6.0-jdk-8-slim AS build

# Set the working directory to /app
WORKDIR /app

# Copy the pom.xml and src directories to the container
COPY pom.xml .
COPY src ./src

# Build the application with Maven
RUN mvn package

# Start with a base image containing Tomcat server running with JRE8
FROM tomcat:9-jre8-alpine

# Set the working directory to /usr/local/tomcat
WORKDIR /usr/local/tomcat

# Copy the custom server.xml file to the container
COPY server.xml ./conf

# Remove any existing files in the webapps directory of Tomcat
RUN rm -rf ./webapps/*

# Copy the WAR file generated by Maven into the webapps directory of Tomcat
ARG JAR_FILE=*.war
COPY --from=build /app/target/${JAR_FILE} ./webapps/edu-msa-comment-1.0.0.war

# Expose the port the application will listen on
EXPOSE 28084

# Start the Tomcat server
CMD ["catalina.sh", "run"]
